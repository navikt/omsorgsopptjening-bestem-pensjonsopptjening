<html>
<head>
    <meta charset="utf8">
    <script>
        function init() {
            let tjeneste = localStorage.getItem("tjeneste");
            if (tjeneste) {
                document.getElementById("tjeneste").value = tjeneste
            } else {
                document.getElementById("tjeneste").value = "rekjor_meldinger"
            }
            oppdater_tjeneste()
            oppdater_miljo()
        }

        function oppdater_tjeneste() {
            let tjeneste = document.getElementById("tjeneste").value;

            function setActionAndText(action, text) {
                document.getElementById("mainForm").action = action
                document.getElementById("mainForm_submit").textContent = text
            }

            function setBeskrivelseEnabled(enabled) {
                let begrunnelse = document.getElementById("begrunnelse");
                begrunnelse.disabled = !enabled
                if (enabled) {
                    begrunnelse.style.backgroundColor = null
                } else {
                    begrunnelse.style.backgroundColor = "lightgrey"
                }
            }

            switch (tjeneste) {
                case "rekjor_meldinger":
                    setActionAndText("/bestem/rekjor-flere", "Rekjør meldinger")
                    setBeskrivelseEnabled(true)
                    break;
                case "stopp_meldinger":
                    setActionAndText("/bestem/stopp-flere", "Stopp meldinger")
                    setBeskrivelseEnabled(true)
                    break;
                case "avslutt_meldinger":
                    setActionAndText("/bestem/avslutt-flere", "Avslutt meldinger")
                    setBeskrivelseEnabled(true)
                    break;
                case "restart_oppgaver":
                    setActionAndText("/bestem/restart-oppgaver", "Restart oppgaver")
                    setBeskrivelseEnabled(false)
                    break;
                case "kanseller_oppgaver":
                    setActionAndText("/bestem/kanseller-oppgaver", "Restart oppgaver")
                    setBeskrivelseEnabled(true)
                    break;
                case "restart_brev":
                    setActionAndText("/bestem/restart-brev", "Restart brev")
                    setBeskrivelseEnabled(false)
                    break;
                case "kanseller_oppgaver":
                    setActionAndText("/bestem/kanseller-oppgaver", "Kanseller oppgaver")
                    setBeskrivelseEnabled(false)
                    break;
                case "test":
                    setActionAndText("/bestem/test","TEST")
                    setBeskrivelseEnabled(true)
                    break;
                default:
                    setActionAndText("INVALID", "Feil: ukjent tjeneste: " + tjeneste)
            }

        }

        function oppdater_miljo() {
            let env = document.getElementById("environmentLabel")
            function setColor(bgColor, textColor) {
                env.style.backgroundColor = bgColor
                env.style.color = textColor
            }

            function setText(text) {
                env.textContent = text
            }

            switch (document.location.hostname) {
                case "localhost":
                    setColor("darkblue","white")
                    setText("Localhost")
                    break;
                case "omsorgsopptjening-bestem-pensjonsopptjening.intern.dev.nav.no":
                    setColor("lightgreen","black")
                    setText("Test")
                    break;
                case "omsorgsopptjening-bestem-pensjonsopptjening.intern.nav.no":
                    setColor("red","yellow")
                    setText("PRODUKSJON")
                    break;
                default:
                    setColor("yellow","black")
                    setText("ukjent domene: "+document.location.hostname)
            }
        }

        function velg_tjeneste() {
            let tjeneste = document.getElementById("tjeneste").value;
            localStorage.setItem("tjeneste", tjeneste)
            oppdater_tjeneste()
        }
    </script>
</head>
<body onload="init()">
<h1>Omsorgsopptjening - Administrasjon av meldinger</h1>

<p>
<div id="environmentLabel">
    Ikke initalisert. Fiks javascript.
</div>

<p>
    Send inn en liste med gyldige meldingsid'er. Det må være én per linje, uten quotes eller kommaer.
</p>
<p>
    Prosessering av disse meldingene vil bli stoppet, men allerede videresendt informasjon (brev, oppgaver,
    godskriving) vil ikke bli kansellert/tilbakekalt.
</p>

<form>
    <label for="tjeneste">Velg funksjon</label>
    <select id="tjeneste" onchange="javascript:velg_tjeneste()">
        <option value="rekjor_meldinger">Rekjør meldinger (stopp og opprett ny kopi)</option>
        <option value="stopp_meldinger">Stopp meldinger (stopper også oppgaver og brev)</option>
        <option value="avslutt_meldinger">Avslutt meldinger (marker som ferdige)</option>
        <option value="restart_oppgaver">Restart oppgaver (begynn prosessering igjen fra klar)</option>
        <option value="kanseller_oppgaver">Kanseller (trekk tilbake) oppgaver</option>
        <option value="restart_brev">Restart brev (begynn prosessering igjen fra klar)</option>
        <option value="test">TEST (intern, midlertidig)</option>
    </select>
</form>

<form id="mainForm" action="/bestem/rekjor-flere" method="post">
    <table>
        <tbody>
        <tr>
            <td>
                <label for="begrunnelse">Begrunnelse</label>
            </td>
            <td>
                <input type="text" id="begrunnelse" name="begrunnelse" size="50" maxlength="50"/>
            </td>
            <td>
                <button type="submit" id="mainForm_submit">Velg tjeneste</button>
            </td>
        </tr>
        <tr>
            <td>
                <label for="uuidliste">UUID'er</label>
            </td>
            <td>
                <textarea name="uuidliste" id="uuidliste" rows="50" cols="50"></textarea>
            </td>
        </tr>
        </tbody>
    </table>
</form>
</body>
</html>